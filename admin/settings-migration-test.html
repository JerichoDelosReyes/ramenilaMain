<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings Migration Test - Ramenila</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .warning {
            background-color: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
        }
        .info {
            background-color: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .danger {
            background-color: #dc3545;
        }
        .danger:hover {
            background-color: #c82333;
        }
        pre {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçú Ramenila Settings Migration Test</h1>
            <p>Test your new local storage-based settings system</p>
        </div>

        <div class="section info">
            <h3>üìã Migration Status</h3>
            <p id="migration-status">Checking current setup...</p>
        </div>

        <div class="section">
            <h3>üîß Current Settings</h3>
            <button onclick="loadCurrentSettings()">Load Current Settings</button>
            <button onclick="showDefaultSettings()">Show Default Settings</button>
            <pre id="current-settings" class="hidden"></pre>
        </div>

        <div class="section">
            <h3>üë• Current Users</h3>
            <button onclick="loadCurrentUsers()">Load Current Users</button>
            <button onclick="showDefaultUsers()">Show Default Users</button>
            <pre id="current-users" class="hidden"></pre>
        </div>

        <div class="section warning">
            <h3>‚ö†Ô∏è Test Operations</h3>
            <p><strong>Warning:</strong> These operations will modify your local storage data!</p>
            <button onclick="createTestSettings()">Create Test Settings</button>
            <button onclick="createTestUser()">Add Test User</button>
            <button onclick="resetToDefaults()">Reset to Defaults</button>
        </div>

        <div class="section">
            <h3>üóëÔ∏è Data Management</h3>
            <button onclick="exportData()">Export All Data</button>
            <button onclick="importData()">Import Data</button>
            <button onclick="clearAllData()" class="danger">Clear All Data</button>
            <div id="export-data" class="hidden">
                <h4>Exported Data (Copy this for backup):</h4>
                <textarea id="export-text" style="width: 100%; height: 200px;" readonly></textarea>
            </div>
            <div id="import-data" class="hidden">
                <h4>Import Data (Paste exported data here):</h4>
                <textarea id="import-text" style="width: 100%; height: 150px;" placeholder="Paste exported data here..."></textarea>
                <br>
                <button onclick="performImport()">Import</button>
                <button onclick="cancelImport()">Cancel</button>
            </div>
        </div>

        <div class="section success">
            <h3>‚úÖ Test Results</h3>
            <div id="test-results">
                <p>Run tests above to see results here...</p>
            </div>
        </div>

        <div class="section">
            <h3>üîó Navigation</h3>
            <p>Once testing is complete:</p>
            <a href="settings.html" style="text-decoration: none;">
                <button>Go to Settings Page</button>
            </a>
            <a href="dashboard.html" style="text-decoration: none;">
                <button>Go to Dashboard</button>
            </a>
        </div>
    </div>

    <script>
        // Test the new localStorage-based settings system
        let testResults = [];

        function addTestResult(test, status, details = '') {
            testResults.push({ test, status, details, timestamp: new Date().toLocaleTimeString() });
            updateTestResults();
        }

        function updateTestResults() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = testResults.map(result => 
                `<div style="margin: 10px 0; padding: 10px; border-left: 4px solid ${result.status === 'PASS' ? '#28a745' : result.status === 'WARN' ? '#ffc107' : '#dc3545'}; background-color: ${result.status === 'PASS' ? '#d4edda' : result.status === 'WARN' ? '#fff3cd' : '#f8d7da'};">
                    <strong>[${result.timestamp}] ${result.test}:</strong> ${result.status}
                    ${result.details ? `<br><small>${result.details}</small>` : ''}
                </div>`
            ).join('');
        }

        function checkMigrationStatus() {
            const hasSettings = localStorage.getItem('ramenila_settings') !== null;
            const hasUsers = localStorage.getItem('ramenila_users') !== null;
            
            let status = '';
            if (hasSettings && hasUsers) {
                status = '‚úÖ Migration Complete - Both settings and users found in localStorage';
                addTestResult('Migration Check', 'PASS', 'Settings and users are stored locally');
            } else if (hasSettings || hasUsers) {
                status = '‚ö†Ô∏è Partial Migration - Some data found in localStorage';
                addTestResult('Migration Check', 'WARN', `Settings: ${hasSettings ? 'Found' : 'Missing'}, Users: ${hasUsers ? 'Found' : 'Missing'}`);
            } else {
                status = '‚ùå No Migration Data - localStorage is empty (this is normal for new installations)';
                addTestResult('Migration Check', 'INFO', 'No existing data found - defaults will be created');
            }
            
            document.getElementById('migration-status').innerHTML = status;
        }

        function loadCurrentSettings() {
            const settings = localStorage.getItem('ramenila_settings');
            const settingsDiv = document.getElementById('current-settings');
            
            if (settings) {
                settingsDiv.textContent = JSON.stringify(JSON.parse(settings), null, 2);
                settingsDiv.classList.remove('hidden');
                addTestResult('Load Settings', 'PASS', 'Settings loaded from localStorage');
            } else {
                settingsDiv.textContent = 'No settings found in localStorage';
                settingsDiv.classList.remove('hidden');
                addTestResult('Load Settings', 'WARN', 'No settings found - defaults will be used');
            }
        }

        function loadCurrentUsers() {
            const users = localStorage.getItem('ramenila_users');
            const usersDiv = document.getElementById('current-users');
            
            if (users) {
                usersDiv.textContent = JSON.stringify(JSON.parse(users), null, 2);
                usersDiv.classList.remove('hidden');
                addTestResult('Load Users', 'PASS', 'Users loaded from localStorage');
            } else {
                usersDiv.textContent = 'No users found in localStorage';
                usersDiv.classList.remove('hidden');
                addTestResult('Load Users', 'WARN', 'No users found - defaults will be created');
            }
        }

        function showDefaultSettings() {            const defaultSettings = {
                general: {
                    language: 'en',
                    currency: 'PHP',
                    timezone: 'Asia/Manila',
                    dateFormat: 'MM/DD/YYYY',
                    timeFormat: '12'
                },
                restaurant: {
                    name: 'Ramenila',
                    address: '',
                    phone: '',
                    email: '',
                    hours: {
                        monday: { open: '11:00', close: '22:00', isOpen: true },
                        tuesday: { open: '11:00', close: '22:00', isOpen: true },
                        wednesday: { open: '11:00', close: '22:00', isOpen: true },
                        thursday: { open: '11:00', close: '22:00', isOpen: true },
                        friday: { open: '11:00', close: '23:00', isOpen: true },
                        saturday: { open: '11:00', close: '23:00', isOpen: true },
                        sunday: { open: '12:00', close: '21:00', isOpen: true }
                    }
                },
                pos: {
                    cashEnabled: true,
                    cardEnabled: true,
                    mobileEnabled: false,
                    taxRate: 8.25,
                    tipSuggestions: '15,18,20,25',
                    autoPrint: true,
                    emailReceipts: false,
                    receiptFooter: 'Thank you for visiting Ramenila!'
                }
            };
            
            const settingsDiv = document.getElementById('current-settings');
            settingsDiv.textContent = JSON.stringify(defaultSettings, null, 2);
            settingsDiv.classList.remove('hidden');
            addTestResult('Show Defaults', 'INFO', 'Default settings structure displayed');
        }

        function showDefaultUsers() {
            const defaultUsers = [
                {
                    id: 1,
                    name: 'Admin User',
                    email: 'jericho.dlsreyes@gmail.com',
                    role: 'admin',
                    lastLogin: 'Today, 2:30 PM',
                    status: 'active',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 2,
                    name: 'Manager User',
                    email: 'justinecoronel001@gmail.com',
                    role: 'manager',
                    lastLogin: 'Yesterday, 5:45 PM',
                    status: 'active',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 3,
                    name: 'Cashier User',
                    email: 'norona.leeadrian022804@gmail.com',
                    role: 'cashier',
                    lastLogin: '2 days ago',
                    status: 'active',
                    createdAt: new Date().toISOString()
                }
            ];
            
            const usersDiv = document.getElementById('current-users');
            usersDiv.textContent = JSON.stringify(defaultUsers, null, 2);
            usersDiv.classList.remove('hidden');
            addTestResult('Show Default Users', 'INFO', 'Default users structure displayed');
        }

        function createTestSettings() {            const testSettings = {
                general: {
                    language: 'en',
                    currency: 'USD',
                    timezone: 'America/New_York',
                    dateFormat: 'YYYY-MM-DD',
                    timeFormat: '24'
                },
                restaurant: {
                    name: 'Ramenila Test',
                    address: '123 Test Street',
                    phone: '+1-555-TEST',
                    email: 'test@ramenila.com'
                },
                pos: {
                    taxRate: 10.0,
                    tipSuggestions: '10,15,20'
                }
            };
            
            localStorage.setItem('ramenila_settings', JSON.stringify(testSettings));
            addTestResult('Create Test Settings', 'PASS', 'Test settings saved to localStorage');
            loadCurrentSettings();
        }

        function createTestUser() {
            let users = localStorage.getItem('ramenila_users');
            users = users ? JSON.parse(users) : [];
            
            const testUser = {
                id: Math.max(...users.map(u => u.id), 0) + 1,
                name: 'Test User',
                email: 'test@example.com',
                role: 'cashier',
                status: 'active',
                lastLogin: 'Never',
                createdAt: new Date().toISOString()
            };
            
            users.push(testUser);
            localStorage.setItem('ramenila_users', JSON.stringify(users));
            addTestResult('Create Test User', 'PASS', `Test user created with ID ${testUser.id}`);
            loadCurrentUsers();
        }

        function resetToDefaults() {
            localStorage.removeItem('ramenila_settings');
            localStorage.removeItem('ramenila_users');
            addTestResult('Reset to Defaults', 'PASS', 'All settings and users cleared from localStorage');
            
            // Reload to show empty state
            loadCurrentSettings();
            loadCurrentUsers();
        }

        function exportData() {
            const settings = localStorage.getItem('ramenila_settings');
            const users = localStorage.getItem('ramenila_users');
            
            const exportData = {
                settings: settings ? JSON.parse(settings) : null,
                users: users ? JSON.parse(users) : null,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            document.getElementById('export-text').value = JSON.stringify(exportData, null, 2);
            document.getElementById('export-data').classList.remove('hidden');
            addTestResult('Export Data', 'PASS', 'Data exported successfully');
        }

        function importData() {
            document.getElementById('import-data').classList.remove('hidden');
        }

        function performImport() {
            try {
                const importText = document.getElementById('import-text').value;
                const importData = JSON.parse(importText);
                
                if (importData.settings) {
                    localStorage.setItem('ramenila_settings', JSON.stringify(importData.settings));
                }
                if (importData.users) {
                    localStorage.setItem('ramenila_users', JSON.stringify(importData.users));
                }
                
                addTestResult('Import Data', 'PASS', 'Data imported successfully');
                document.getElementById('import-data').classList.add('hidden');
                loadCurrentSettings();
                loadCurrentUsers();
            } catch (error) {
                addTestResult('Import Data', 'FAIL', `Import failed: ${error.message}`);
            }
        }

        function cancelImport() {
            document.getElementById('import-data').classList.add('hidden');
            document.getElementById('import-text').value = '';
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear ALL localStorage data? This cannot be undone!')) {
                localStorage.removeItem('ramenila_settings');
                localStorage.removeItem('ramenila_users');
                addTestResult('Clear All Data', 'PASS', 'All data cleared from localStorage');
                
                // Clear displays
                document.getElementById('current-settings').textContent = 'Data cleared';
                document.getElementById('current-users').textContent = 'Data cleared';
                checkMigrationStatus();
            }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            checkMigrationStatus();
            addTestResult('Page Load', 'PASS', 'Migration test page loaded successfully');
        });
    </script>
</body>
</html>
